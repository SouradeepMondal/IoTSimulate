<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT Sensor Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <style>
    /* Base Styles (Light Theme) */
    .chart-container {
        max-width: 900px;
        margin: 20px auto;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0,0,0,.1);
        background-color: #fff; /* White */
    }
    .theme-card {
        background-color: #f8f9fa; /* Light grey */
        color: #212529; /* Dark text */
    }

    /* --- DARK THEME OVERRIDES --- */
    body.dark-theme {
        background-color: #212529 !important; /* Very dark background */
        color: #f8f9fa !important; /* Light text */
    }
    body.dark-theme .chart-container {
        background-color: #343a40; /* Darker grey for charts */
        box-shadow: 0 4px 8px rgba(0, 0, 0, .4);
    }
    body.dark-theme .theme-card {
        background-color: #495057; /* Medium dark grey for cards */
        color: #f8f9fa; /* Light text */
    }
    body.dark-theme .text-muted {
        color: #adb5bd !important; /* Slightly brighter muted text */
    }
    body.dark-theme .text-primary {
        color: #9ac2ff !important; /* Lighter primary color for contrast */
    }
    /* Style the toggle button inside the dark theme */
    body.dark-theme #theme-toggle {
        border-color: #adb5bd !important;
        color: #adb5bd !important;
    }
</style>
</head>
<body class="text-dark">
    <header class="bg-primary text-white p-3 mb-4">
        <div class="container d-flex justify-content-between align-items-center">
            <h1 class="h3 mb-0">üè° Local IoT Data Monitor</h1>
            <button id="theme-toggle" class="btn btn-outline-light">
                <span class="light-icon">‚òÄÔ∏è Light Mode</span>
                <span class="dark-icon" style="display: none;">üåô Dark Mode</span>
            </button>
        </div>
    </header>

    <main class="container">
        <section id="overview" class="mb-5">
            <h2 class="text-primary mb-3">Real-time Readings</h2>
            <div class="row">
                <div class="col-md-4">
                    <div class="card text-center mb-3 theme-card">
                        <div class="card-body">
                            <h5 class="card-title">üå°Ô∏è Temperature (¬∞C)</h5>
                            <p class="card-text display-4" id="temp-value">--</p>
                            <p class="text-muted" id="temp-time">Last updated: --</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card text-center mb-3 theme-card">
                        <div class="card-body">
                            <h5 class="card-title">üíß Humidity (%)</h5>
                            <p class="card-text display-4" id="humidity-value">--</p>
                            <p class="text-muted" id="humidity-time">Last updated: --</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card text-center mb-3 theme-card">
                        <div class="card-body">
                            <h5 class="card-title">üí° Light (lux)</h5>
                            <p class="card-text display-4" id="light-value">--</p>
                            <p class="text-muted" id="light-time">Last updated: --</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="device-states" class="mb-5">
            <h2 class="text-primary mb-3">Device Control States</h2>
            <div class="row">
                <div class="col-md-4">
                    <div class="card text-center mb-3 theme-card">
                        <div class="card-body">
                            <h5 class="card-title">‚ùÑÔ∏è/üî• HVAC Status</h5>
                            <p class="card-text display-5" id="ac-state">IDLE</p>
                            <p class="text-muted" id="ac-updated">Updated: --</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card text-center mb-3 theme-card">
                        <div class="card-body">
                            <h5 class="card-title">üíß Dehumidifier</h5>
                            <p class="card-text display-5" id="dehumidifier-state">IDLE</p>
                            <p class="text-muted" id="dehumidifier-updated">Updated: --</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card text-center mb-3 theme-card">
                        <div class="card-body">
                            <h5 class="card-title">üí° Light Brightness</h5>
                            <p class="card-text display-5" id="light-state">0%</p>
                            <p class="text-muted" id="light-updated">Updated: --</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="charts" class="mb-5">
            <h2 class="text-primary mb-3">Historical Data</h2>

            <div class="chart-container">
                <canvas id="temperatureChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="humidityChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="lightChart"></canvas>
            </div>
        </section>

        <section id="actions-log" class="mb-5">
            <h2 class="text-primary mb-3">Server Action Log</h2>
            <div class="card theme-card p-3">
                <ul id="action-list" class="list-group list-group-flush" style="max-height: 400px; overflow-y: auto;">
                    </ul>
            </div>
        </section>
        
    </main>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>